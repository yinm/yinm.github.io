<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>#259 Web API with connpass</title>
</head>
<body>
  <h1>connpassの勉強会を検索できます！:3</h1>

  <input id="search" type="text" placeholder="勉強会のキーワード">
  <button id="btn">検索</button>

  <ul id="eventList"></ul>
  
  <p>参考：
  <a href="http://paiza.hatenablog.com/entry/2016/06/21/%E9%9D%A2%E5%80%92%E3%81%AA%E6%89%8B%E7%B6%9A%E3%81%8D%E4%B8%8D%E8%A6%81%EF%BC%81%E3%80%8CWeb_API%E3%80%8D%E3%81%AE%E8%B6%85%E3%81%8A%E6%89%8B%E8%BB%BD%E6%B4%BB%E7%94%A8%E8%A1%93%E3%82%92JavaScript">paiza開発日誌</a>
  </p>

<script>
const btn = document.getElementById('btn');
const eventList = document.getElementById('eventList');

btn.addEventListener('click', function() {
  const script = document.createElement('script');
  const search = document.getElementById('search').value;

  eventList.innerHTML = 'データ検索中・・・';

  script.src = 'https://connpass.com/api/v1/event/?keyword_or=' + search + '&callback=jsonData';

  document.body.appendChild(script);
  document.body.removeChild(script);
}, false);

function jsonData(data) {
  eventList.innerHTML = '';

  for (let i = 0; i < data.events.length; i++) {
    const li = document.createElement('li');
    const a = document.createElement('a');

    a.textContent = data.events[i].title;
    a.href = data.events[i].event_url;
    a.target = '_blank';
    li.appendChild(a);
    eventList.appendChild(li);
  }

}
</script>

</body>
</html>

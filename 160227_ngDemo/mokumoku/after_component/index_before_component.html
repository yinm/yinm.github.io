<!DOCTYPE html>
<html lang="ja" ng-app="myApp">
<head>
  <meta charset="UTF-8">
  <title>mokumoku</title>
  <script src="angular.min.js"></script>
  <style>
    input.ng-invalid {
      border: 1px solid red;
    }
    .done {
      text-decoration: line-through;
    }
  </style>
</head>
<body ng-controller="appCtrl as app">

  <form name="todoForm" novalidate>
    <input type="text" name="todo" ng-model="app.todo.name" required>
    <button ng-click="app.clickButton()" ng-disabled="todoForm.$invalid">Click!!</button>
    <input type="text" ng-model="app.search">
  </form>

    <ul>
      <li ng-repeat="item in app.list | filter: app.search | orderBy: '-date'">
        <span ng-click="app.clickList(item)" ng-class="{done: item.done}">{{item.name}} - {{item.date | date: 'yyyy/MM/dd HH:mm:ss'}}</span>
        <button ng-click="app.clickDeleteButton(item)" ng-show="item.done">削除</button>
      </li>
    </ul>

</body>
<script>
  (function() {
    angular.module('myApp', [])
      .controller('appCtrl', [function() {
        this.list = [];

        // todoの追加
        this.clickButton = function() {
          this.todo.date = Date.now();
          this.list.push(this.todo);
          this.todo = {};
        };

        // 終了時に打ち消し線
        this.clickList = function(item) {
          item.done = !item.done;
        }

        // 削除機能
        this.clickDeleteButton = function(item) {
          var idx = this.list.indexOf(item);
          if (idx >= 0) {
            this.list.splice(idx, 1);
          }
        }


      }])
  })();
</script>
</html>
